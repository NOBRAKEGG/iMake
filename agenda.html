<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Agenda | OFF Company</title>

<style>
  @font-face{
    font-family:"Rokiest";
    src:url("https://waycompanygg.github.io/roteiro/assets/fonts/Rokiest-Extrabold.otf") format("opentype");
    font-weight:800; font-display:swap;
  }

  :root{
    --bg1:#060812; --bg2:#0b1220;
    --panel:rgba(10,16,28,.76);
    --stroke:rgba(255,255,255,.10);
    --text:#e5e7eb; --muted:rgba(229,231,235,.62);

    --purple:#8b5cf6;
    --purple2:#a78bfa;
    --cyan:#06b6d4;
    --amber:#f59e0b;
    --orange:#fb923c;
    --green:#22c55e;
    --red:#ef4444;

    --shadow:0 24px 80px rgba(0,0,0,.68);
  }

  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color:var(--text);
    background:
      radial-gradient(900px 520px at 14% 12%, rgba(139,92,246,.18), transparent 60%),
      radial-gradient(900px 520px at 86% 18%, rgba(6,182,212,.12), transparent 60%),
      radial-gradient(900px 520px at 70% 90%, rgba(245,158,11,.10), transparent 60%),
      linear-gradient(135deg,var(--bg1),var(--bg2));
    padding:18px;
  }

  /* Sidebar (mesmo estilo do seu dashboard) */
  .dock{
    position:fixed;
    left:16px; top:16px; bottom:16px;
    width:64px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(10,16,28,.55);
    backdrop-filter: blur(10px);
    box-shadow:0 18px 60px rgba(0,0,0,.45);
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
    padding:10px 8px;
    z-index:50;
  }
  .dock .logo{
    width:44px; height:44px;
    border-radius:14px;
    background:rgba(139,92,246,.16);
    border:1px solid rgba(139,92,246,.28);
    display:flex; align-items:center; justify-content:center;
    font-weight:900; letter-spacing:.5px;
    box-shadow:0 18px 50px rgba(139,92,246,.18);
  }
  .dock a{
    width:44px; height:44px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.05);
    display:flex; align-items:center; justify-content:center;
    text-decoration:none; color:rgba(229,231,235,.9);
    transition:.18s;
    position:relative;
    overflow:hidden;
  }
  .dock a:hover{ transform:translateY(-1px); border-color:rgba(139,92,246,.35) }
  .dock a.active{
    background:linear-gradient(135deg, rgba(139,92,246,.88), rgba(6,182,212,.34));
    border-color:rgba(139,92,246,.40);
  }

  /* Layout principal */
  .page{
    margin-left:92px;
    max-width:1400px;
    margin-right:auto;
  }

  .wrap{
    background:var(--panel);
    border:1px solid var(--stroke);
    border-radius:24px;
    box-shadow:var(--shadow);
    backdrop-filter:blur(10px);
    overflow:hidden;
  }

  .topbar{
    display:flex; justify-content:space-between;
    align-items:center;
    gap:12px;
    padding:16px 16px 10px;
    border-bottom:1px solid rgba(255,255,255,.08);
  }
  .title h1{
    font-family:"Rokiest";
    margin:0;
    letter-spacing:.9px;
    font-size:32px;
  }
  .title .sub{
    margin-top:6px;
    color:var(--muted);
    font-size:13px;
  }

  .actions{
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }

  .search{
    display:flex; align-items:center;
    gap:10px;
    background:rgba(2,6,23,.45);
    border:1px solid rgba(255,255,255,.10);
    border-radius:14px;
    padding:10px 12px;
    min-width:260px;
  }
  .search input{
    width:100%;
    border:0;
    outline:none;
    background:transparent;
    color:var(--text);
    font-weight:700;
  }
  .btn{
    height:40px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.06);
    color:#fff;
    padding:0 12px;
    font-weight:900;
    cursor:pointer;
    transition:.16s;
    display:inline-flex; align-items:center; gap:8px;
  }
  .btn:hover{ transform:translateY(-1px); opacity:.95 }
  .btn.primary{
    border-color:rgba(139,92,246,.35);
    background:linear-gradient(135deg, rgba(139,92,246,.92), rgba(6,182,212,.36));
    box-shadow:0 18px 55px rgba(139,92,246,.16);
  }
  .btn.ghost{ background:rgba(255,255,255,.04) }

  /* Barra de filtros + legenda */
  .bar{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
    padding:12px 16px 14px;
    flex-wrap:wrap;
  }

  .filters{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }
  select{
    height:40px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(2,6,23,.45);
    color:var(--text);
    padding:0 12px;
    outline:none;
    font-weight:900;
  }

  .chips{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .chip{
    height:34px;
    padding:0 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.04);
    color:rgba(229,231,235,.9);
    font-weight:900;
    font-size:12px;
    cursor:pointer;
    transition:.16s;
    display:inline-flex;
    align-items:center;
    gap:8px;
  }
  .chip:hover{ transform:translateY(-1px) }
  .chip.on{ border-color:rgba(139,92,246,.45); background:rgba(139,92,246,.16); }

  .dot{ width:10px; height:10px; border-radius:999px; }

  .legend{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    justify-content:flex-end;
    align-items:center;
    color:rgba(229,231,235,.7);
    font-size:12px;
  }
  .pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.04);
    font-weight:900;
  }

  /* Calend√°rio */
  .cal{
    padding:0 16px 16px;
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:12px;
  }
  @media(max-width:1100px){ .cal{ grid-template-columns:1fr; } }

  .calendar{
    border:1px solid rgba(255,255,255,.10);
    background:rgba(2,6,23,.35);
    border-radius:18px;
    overflow:hidden;
  }
  .calHeader{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 12px;
    border-bottom:1px solid rgba(255,255,255,.08);
    background:rgba(255,255,255,.02);
    gap:10px;
    flex-wrap:wrap;
  }
  .month{
    font-family:Rokiest;
    letter-spacing:.6px;
    font-size:18px;
    display:flex;
    gap:10px;
    align-items:center;
  }
  .nav{
    display:flex; gap:8px; align-items:center;
  }

  .dow{
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    padding:10px 10px;
    border-bottom:1px solid rgba(255,255,255,.06);
    color:rgba(229,231,235,.65);
    font-weight:900;
    font-size:12px;
    text-transform:lowercase;
  }
  .dow div{ padding:4px 8px; }

  .grid{
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap:0;
  }
  .day{
    min-height:140px; /* retangular com espa√ßo p/ compromissos */
    border-right:1px solid rgba(255,255,255,.06);
    border-bottom:1px solid rgba(255,255,255,.06);
    padding:10px 10px;
    position:relative;
    overflow:hidden;
    transition:.16s;
  }
  .day:nth-child(7n){ border-right:0; }
  .day:hover{ background:rgba(139,92,246,.06); }

  .dayNum{
    font-weight:900;
    color:rgba(229,231,235,.85);
    font-size:12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  .tagMini{
    font-size:11px;
    color:rgba(229,231,235,.65);
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.04);
    padding:4px 8px;
    border-radius:999px;
    font-weight:900;
  }

  .cards{
    margin-top:8px;
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .event{
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.04);
    border-radius:14px;
    padding:8px 9px;
    cursor:pointer;
    transition:.16s;
    position:relative;
    overflow:hidden;
  }
  .event:hover{ transform:translateY(-1px); border-color:rgba(139,92,246,.30); }
  .event .t{
    font-weight:900;
    font-size:12px;
    line-height:1.1;
    display:flex; justify-content:space-between; gap:8px;
  }
  .event .m{
    margin-top:4px;
    color:rgba(229,231,235,.65);
    font-size:11px;
    line-height:1.2;
  }
  .event .badge{
    font-size:11px;
    padding:4px 8px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.04);
    font-weight:900;
    white-space:nowrap;
  }

  /* status colors */
  .st-confirmado{ border-color:rgba(34,197,94,.28); background:rgba(34,197,94,.10); }
  .st-reservado{ border-color:rgba(139,92,246,.30); background:rgba(139,92,246,.12); }
  .st-negociando{ border-color:rgba(245,158,11,.26); background:rgba(245,158,11,.10); }
  .st-outros{ border-color:rgba(255,255,255,.10); background:rgba(255,255,255,.04); }
  .st-radio{ border-color:rgba(239,68,68,.25); background:rgba(239,68,68,.10); }
  .st-lembrete{ border-color:rgba(6,182,212,.25); background:rgba(6,182,212,.10); }

  /* artista colors (borda lateral) */
  .artistBar{
    position:absolute; left:0; top:0; bottom:0;
    width:6px;
    border-radius:14px 0 0 14px;
  }

  /* Painel de detalhes */
  .details{
    border:1px solid rgba(255,255,255,.10);
    background:rgba(2,6,23,.35);
    border-radius:18px;
    overflow:hidden;
    position:sticky;
    top:16px;
    height:fit-content;
  }
  .detailsHead{
    padding:14px 14px 12px;
    border-bottom:1px solid rgba(255,255,255,.08);
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
  }
  .detailsHead .h{
    font-family:Rokiest;
    letter-spacing:.6px;
    font-size:18px;
  }
  .detailsBody{
    padding:14px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .field{
    display:flex; flex-direction:column;
    gap:6px;
  }
  .field label{
    font-size:12px;
    color:rgba(229,231,235,.70);
    font-weight:900;
  }
  .field input, .field textarea{
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.04);
    padding:10px 10px;
    color:var(--text);
    outline:none;
    font-weight:700;
  }
  textarea{ resize:none; min-height:92px; }

  .row2{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  @media(max-width:1100px){ .row2{ grid-template-columns:1fr; } }

  .toggle{
    display:flex; align-items:center; justify-content:space-between;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.04);
    border-radius:14px;
    padding:10px 10px;
    font-weight:900;
  }
  .switch{
    width:48px; height:28px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(255,255,255,.06);
    position:relative;
    cursor:pointer;
    transition:.16s;
  }
  .knob{
    width:22px; height:22px; border-radius:999px;
    background:rgba(229,231,235,.85);
    position:absolute; top:2px; left:2px;
    transition:.16s;
  }
  .switch.on{
    border-color:rgba(34,197,94,.35);
    background:rgba(34,197,94,.18);
  }
  .switch.on .knob{ left:24px; background:#eafff2; }

  /* Modal criar */
  .overlay{
    position:fixed; inset:0;
    display:none;
    align-items:center; justify-content:center;
    background:rgba(0,0,0,.55);
    backdrop-filter:blur(10px);
    z-index:9999;
    padding:18px;
  }
  .modal{
    width:min(760px, 96vw);
    border-radius:18px;
    border:1px solid rgba(255,255,255,.14);
    background:rgba(11,18,32,.92);
    box-shadow:0 20px 70px rgba(0,0,0,.70);
    padding:14px;
    animation: pop .18s ease both;
  }
  @keyframes pop{from{opacity:0;transform:scale(.98)}to{opacity:1;transform:scale(1)}}

  /* micro anima√ß√µes */
  .fadeIn{
    animation: in .35s ease both;
  }
  @keyframes in{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

  .note{
    color:rgba(229,231,235,.6);
    font-size:12px;
    line-height:1.3;
  }
</style>
</head>

<body>

<!-- Dock -->
<nav class="dock">
  <div class="logo">OFF</div>
  <a href="index.html" title="Home">üè†</a>
  <a class="active" href="agenda.html" title="Agenda">üóìÔ∏è</a>
  <a href="vip.html" title="VIP">üéüÔ∏è</a>
  <a href="pix.html" title="PIX">üí∏</a>
  <a href="diaria.html" title="Di√°ria">üìí</a>
  <a href="van.html" title="Van">üöê</a>
</nav>

<div class="page">
  <div class="wrap fadeIn">
    <div class="topbar">
      <div class="title">
        <h1>Agenda</h1>
        <div class="sub">OFF Company ‚Ä¢ Calend√°rio mensal com gest√£o visual de compromissos</div>
      </div>

      <div class="actions">
        <div class="search" title="Busca visual (client-side)">
          üîé <input id="q" placeholder="Buscar compromisso, local, cidade..." />
        </div>
        <button class="btn ghost" id="todayBtn">Hoje</button>
        <button class="btn primary" id="newBtn">Ôºã Novo compromisso</button>
      </div>
    </div>

    <div class="bar">
      <div class="filters">
        <select id="artistFilter">
          <option value="all">Todos artistas</option>
        </select>

        <div class="chips" id="statusChips"></div>
      </div>

      <div class="legend">
        <span class="pill"><span class="dot" style="background:var(--green)"></span> Confirmado</span>
        <span class="pill"><span class="dot" style="background:var(--purple)"></span> Reservado</span>
        <span class="pill"><span class="dot" style="background:var(--amber)"></span> Negociando</span>
        <span class="pill"><span class="dot" style="background:var(--cyan)"></span> Lembrete</span>
        <span class="pill"><span class="dot" style="background:var(--red)"></span> R√°dio/TV</span>
        <span class="pill"><span class="dot" style="background:rgba(255,255,255,.35)"></span> Outros</span>
      </div>
    </div>

    <div class="cal">
      <!-- Calendar -->
      <div class="calendar">
        <div class="calHeader">
          <div class="month">
            <span id="monthLabel">‚Äî</span>
            <span class="tagMini" id="monthMeta">‚Äî</span>
          </div>
          <div class="nav">
            <button class="btn" id="prevBtn">‚Üê</button>
            <button class="btn" id="nextBtn">‚Üí</button>
          </div>
        </div>

        <div class="dow">
          <div>domingo</div><div>segunda</div><div>ter√ßa</div><div>quarta</div><div>quinta</div><div>sexta</div><div>s√°bado</div>
        </div>

        <div class="grid" id="grid"></div>
      </div>

      <!-- Details -->
      <aside class="details">
        <div class="detailsHead">
          <div class="h">Detalhes</div>
          <button class="btn ghost" id="clearSelection">Limpar</button>
        </div>

        <div class="detailsBody" id="detailsBody">
          <div class="note">
            Clique em um compromisso no calend√°rio para ver/editar detalhes (visual).
          </div>
        </div>
      </aside>
    </div>
  </div>
</div>

<!-- Modal Novo -->
<div class="overlay" id="modal">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;">
      <div style="font-family:Rokiest;letter-spacing:.6px;font-size:18px;">Novo compromisso</div>
      <button class="btn ghost" id="closeModal">‚úï</button>
    </div>

    <div style="height:1px;background:rgba(255,255,255,.08);margin:12px 0;"></div>

    <div class="row2">
      <div class="field">
        <label>T√≠tulo</label>
        <input id="m_title" placeholder="Ex: Show / Evento / Ensaio" />
      </div>
      <div class="field">
        <label>Status</label>
        <select id="m_status">
          <option value="CONFIRMADO">CONFIRMADO</option>
          <option value="RESERVADO">RESERVADO</option>
          <option value="NEGOCIANDO">NEGOCIANDO</option>
          <option value="LEMBRETE">LEMBRETE</option>
          <option value="RADIO/TV">R√ÅDIO/TV</option>
          <option value="OUTROS">OUTROS</option>
        </select>
      </div>
    </div>

    <div class="row2">
      <div class="field">
        <label>Artista</label>
        <select id="m_artist"></select>
      </div>
      <div class="field">
        <label>Data</label>
        <input id="m_date" type="date"/>
      </div>
    </div>

    <div class="row2">
      <div class="field">
        <label>Hora</label>
        <input id="m_time" placeholder="Ex: 22:30" />
      </div>
      <div class="field">
        <label>Cidade/Local</label>
        <input id="m_place" placeholder="Ex: Pra√ßa P√∫blica ‚Ä¢ SP" />
      </div>
    </div>

    <div class="field">
      <label>Observa√ß√µes</label>
      <textarea id="m_notes" placeholder="Contrato, log√≠stica, lembretes..."></textarea>
    </div>

    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px;flex-wrap:wrap;">
      <button class="btn ghost" id="cancelNew">Cancelar</button>
      <button class="btn primary" id="saveNew">Salvar (visual)</button>
    </div>

    <div class="note" style="margin-top:10px">
      *Nesta fase √© apenas visual (n√£o salva na planilha). Depois a gente liga com o backend.
    </div>
  </div>
</div>

<script>
  // ====== Dados mock (visual) ======
  const ARTISTS = [
    { id:"ARTISTA X", color:"var(--amber)" },
    { id:"ARTISTA Y", color:"var(--orange)" },
    { id:"ARTISTA Z", color:"var(--cyan)" },
  ];

  const STATUS = [
    { id:"CONFIRMADO",  color:"var(--green)",   cls:"st-confirmado" },
    { id:"RESERVADO",   color:"var(--purple)",  cls:"st-reservado" },
    { id:"NEGOCIANDO",  color:"var(--amber)",   cls:"st-negociando" },
    { id:"LEMBRETE",    color:"var(--cyan)",    cls:"st-lembrete" },
    { id:"RADIO/TV",    color:"var(--red)",     cls:"st-radio" },
    { id:"OUTROS",      color:"rgba(255,255,255,.35)", cls:"st-outros" },
  ];

  // eventos em mem√≥ria (visual)
  let events = [
    { id: uid(), date: toISO(new Date()), title:"Reuni√£o / Briefing", status:"LEMBRETE", artist:"ARTISTA X", time:"16h", place:"Online", contractor:"‚Äî", phone:"‚Äî", contractSent:false, address:"‚Äî", notes:"" },
    { id: uid(), date: addDaysISO(2), title:"Show - Camarote", status:"CONFIRMADO", artist:"ARTISTA Y", time:"00:30", place:"Sapuca√≠ ‚Ä¢ RJ", contractor:"Jo√£o", phone:"(21) 9xxxx-xxxx", contractSent:true, address:"RJ ‚Ä¢ Sapuca√≠", notes:"Chegar 2h antes" },
    { id: uid(), date: addDaysISO(5), title:"Evento - Pub", status:"NEGOCIANDO", artist:"ARTISTA Z", time:"22:30", place:"Centro ‚Ä¢ MG", contractor:"‚Äî", phone:"‚Äî", contractSent:false, address:"‚Äî", notes:"Aguardando resposta" },
  ];

  // ====== Estado ======
  let view = {
    year: new Date().getFullYear(),
    month: new Date().getMonth(),
    artist: "all",
    status: new Set(STATUS.map(s=>s.id)),
    q: "",
    selectedId: null
  };

  // ====== Init UI ======
  const gridEl = document.getElementById("grid");
  const monthLabel = document.getElementById("monthLabel");
  const monthMeta = document.getElementById("monthMeta");
  const artistFilter = document.getElementById("artistFilter");
  const statusChips = document.getElementById("statusChips");
  const qEl = document.getElementById("q");

  // populate artists
  ARTISTS.forEach(a=>{
    const opt = document.createElement("option");
    opt.value = a.id;
    opt.textContent = a.id;
    artistFilter.appendChild(opt);
  });

  // populate modal artist
  const mArtist = document.getElementById("m_artist");
  ARTISTS.forEach(a=>{
    const opt = document.createElement("option");
    opt.value = a.id;
    opt.textContent = a.id;
    mArtist.appendChild(opt);
  });

  // status chips
  STATUS.forEach(s=>{
    const b = document.createElement("button");
    b.className = "chip on";
    b.dataset.status = s.id;
    b.innerHTML = `<span class="dot" style="background:${s.color}"></span>${s.id}`;
    b.onclick = ()=>{
      if(view.status.has(s.id)){
        view.status.delete(s.id);
        b.classList.remove("on");
      }else{
        view.status.add(s.id);
        b.classList.add("on");
      }
      render();
    };
    statusChips.appendChild(b);
  });

  // handlers
  document.getElementById("prevBtn").onclick = ()=>{ shiftMonth(-1); };
  document.getElementById("nextBtn").onclick = ()=>{ shiftMonth(1); };
  document.getElementById("todayBtn").onclick = ()=>{
    const d = new Date();
    view.year = d.getFullYear();
    view.month = d.getMonth();
    render();
  };

  artistFilter.onchange = (e)=>{ view.artist = e.target.value; render(); };

  qEl.addEventListener("input", ()=>{
    view.q = (qEl.value||"").trim().toLowerCase();
    render();
  });

  document.getElementById("newBtn").onclick = openModal;
  document.getElementById("closeModal").onclick = closeModal;
  document.getElementById("cancelNew").onclick = closeModal;
  document.getElementById("modal").addEventListener("click", (e)=>{
    if(e.target && e.target.id==="modal") closeModal();
  });

  document.getElementById("saveNew").onclick = ()=>{
    const title = (document.getElementById("m_title").value||"").trim();
    const status = document.getElementById("m_status").value;
    const artist = document.getElementById("m_artist").value;
    const date = document.getElementById("m_date").value;
    const time = (document.getElementById("m_time").value||"").trim();
    const place = (document.getElementById("m_place").value||"").trim();
    const notes = (document.getElementById("m_notes").value||"").trim();

    if(!title || !date){ alert("Preencha T√≠tulo e Data."); return; }

    events.unshift({
      id: uid(),
      title, status, artist, date,
      time: time || "‚Äî",
      place: place || "‚Äî",
      contractor:"‚Äî", phone:"‚Äî", contractSent:false, address:"‚Äî",
      notes
    });

    closeModal();
    render();
  };

  document.getElementById("clearSelection").onclick = ()=>{
    view.selectedId = null;
    renderDetails(null);
    render();
  };

  // ====== Render ======
  function render(){
    // header
    const monthName = new Date(view.year, view.month, 1).toLocaleString("pt-BR", { month:"long" });
    monthLabel.textContent = `${cap(monthName)} ‚Ä¢ ${view.year}`;
    monthMeta.textContent = `${countFilteredEvents()} compromissos`;

    // grid days
    const first = new Date(view.year, view.month, 1);
    const startDow = first.getDay(); // 0..6
    const daysInMonth = new Date(view.year, view.month+1, 0).getDate();

    // build 6 weeks
    const totalCells = 42;
    const cells = [];

    for(let i=0;i<totalCells;i++){
      const dayNum = i - startDow + 1;
      const inMonth = dayNum>=1 && dayNum<=daysInMonth;
      const dateISO = inMonth ? toISO(new Date(view.year, view.month, dayNum)) : "";

      const dayEvents = inMonth ? getFilteredEventsForDate(dateISO).slice(0,3) : [];
      const moreCount = inMonth ? Math.max(0, getFilteredEventsForDate(dateISO).length - dayEvents.length) : 0;

      cells.push({ inMonth, dayNum, dateISO, dayEvents, moreCount });
    }

    gridEl.innerHTML = cells.map(c=>{
      if(!c.inMonth){
        return `<div class="day" style="opacity:.35; background:rgba(255,255,255,.02)"></div>`;
      }

      const isToday = c.dateISO === toISO(new Date());
      return `
        <div class="day" data-date="${c.dateISO}">
          <div class="dayNum">
            <span>${c.dayNum}</span>
            ${isToday ? `<span class="tagMini" style="border-color:rgba(139,92,246,.35); background:rgba(139,92,246,.14)">hoje</span>` : ``}
          </div>
          <div class="cards">
            ${c.dayEvents.map(ev => renderEventCard(ev)).join("")}
            ${c.moreCount ? `<div class="tagMini" style="width:max-content">+${c.moreCount} mais</div>` : ``}
          </div>
        </div>
      `;
    }).join("");

    // attach clicks
    gridEl.querySelectorAll(".event").forEach(el=>{
      el.addEventListener("click", ()=>{
        const id = el.getAttribute("data-id");
        view.selectedId = id;
        const ev = events.find(x=>x.id===id);
        renderDetails(ev);
        // highlight by re-render (simple)
        gridEl.querySelectorAll(".event").forEach(e2=>e2.style.outline="none");
        el.style.outline = "2px solid rgba(139,92,246,.55)";
        el.style.outlineOffset = "2px";
      });
    });

    // if selection exists, keep details synced
    if(view.selectedId){
      const ev = events.find(x=>x.id===view.selectedId);
      if(ev) renderDetails(ev);
      else renderDetails(null);
    }
  }

  function renderEventCard(ev){
    const st = STATUS.find(s=>s.id===ev.status) || STATUS[STATUS.length-1];
    const art = ARTISTS.find(a=>a.id===ev.artist) || ARTISTS[0];

    return `
      <div class="event ${st.cls}" data-id="${ev.id}">
        <div class="artistBar" style="background:${art.color}"></div>
        <div class="t">
          <span>${esc(ev.title)}</span>
          <span class="badge">${esc(ev.status)}</span>
        </div>
        <div class="m">${esc(ev.time || "‚Äî")} ‚Ä¢ ${esc(ev.place || "‚Äî")}</div>
      </div>
    `;
  }

  function renderDetails(ev){
    const host = document.getElementById("detailsBody");

    if(!ev){
      host.innerHTML = `<div class="note">Clique em um compromisso no calend√°rio para ver/editar detalhes (visual).</div>`;
      return;
    }

    const art = ARTISTS.find(a=>a.id===ev.artist) || ARTISTS[0];
    const st = STATUS.find(s=>s.id===ev.status) || STATUS[0];

    host.innerHTML = `
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
        <span class="pill"><span class="dot" style="background:${art.color}"></span>${esc(ev.artist)}</span>
        <span class="pill"><span class="dot" style="background:${st.color}"></span>${esc(ev.status)}</span>
        <span class="pill">üìÖ ${fmt(ev.date)}</span>
      </div>

      <div class="field">
        <label>T√≠tulo</label>
        <input id="d_title" value="${escAttr(ev.title)}">
      </div>

      <div class="row2">
        <div class="field">
          <label>Hora do show</label>
          <input id="d_time" value="${escAttr(ev.time||"")}">
        </div>
        <div class="field">
          <label>Local / Cidade</label>
          <input id="d_place" value="${escAttr(ev.place||"")}">
        </div>
      </div>

      <div class="row2">
        <div class="field">
          <label>Contratante</label>
          <input id="d_contractor" value="${escAttr(ev.contractor||"")}">
        </div>
        <div class="field">
          <label>N√∫mero</label>
          <input id="d_phone" value="${escAttr(ev.phone||"")}">
        </div>
      </div>

      <div class="field">
        <label>Endere√ßo</label>
        <input id="d_address" value="${escAttr(ev.address||"")}">
      </div>

      <div class="toggle">
        <span>Contrato enviado?</span>
        <div class="switch ${ev.contractSent ? "on":""}" id="d_contract">
          <div class="knob"></div>
        </div>
      </div>

      <div class="field">
        <label>Observa√ß√µes</label>
        <textarea id="d_notes">${esc(ev.notes||"")}</textarea>
      </div>

      <div style="display:flex; gap:10px; justify-content:flex-end; flex-wrap:wrap;">
        <button class="btn ghost" id="d_delete">Excluir (visual)</button>
        <button class="btn primary" id="d_save">Salvar (visual)</button>
      </div>

      <div class="note">
        *Ainda √© s√≥ visual. Depois a gente integra com planilha/Apps Script.
      </div>
    `;

    // bind
    const sw = document.getElementById("d_contract");
    sw.onclick = ()=>{
      ev.contractSent = !ev.contractSent;
      sw.classList.toggle("on", ev.contractSent);
    };

    document.getElementById("d_save").onclick = ()=>{
      ev.title = document.getElementById("d_title").value || ev.title;
      ev.time = document.getElementById("d_time").value || "‚Äî";
      ev.place = document.getElementById("d_place").value || "‚Äî";
      ev.contractor = document.getElementById("d_contractor").value || "‚Äî";
      ev.phone = document.getElementById("d_phone").value || "‚Äî";
      ev.address = document.getElementById("d_address").value || "‚Äî";
      ev.notes = document.getElementById("d_notes").value || "";
      render();
    };

    document.getElementById("d_delete").onclick = ()=>{
      if(!confirm("Excluir este compromisso? (visual)")) return;
      events = events.filter(x=>x.id!==ev.id);
      view.selectedId = null;
      renderDetails(null);
      render();
    };
  }

  // ====== Filters ======
  function getFilteredEventsForDate(dateISO){
    return events
      .filter(ev => ev.date === dateISO)
      .filter(ev => view.artist==="all" ? true : ev.artist === view.artist)
      .filter(ev => view.status.has(ev.status))
      .filter(ev => {
        if(!view.q) return true;
        const hay = `${ev.title} ${ev.place} ${ev.artist} ${ev.status}`.toLowerCase();
        return hay.includes(view.q);
      });
  }

  function countFilteredEvents(){
    const monthStart = new Date(view.year, view.month, 1);
    const monthEnd = new Date(view.year, view.month+1, 0);
    const startISO = toISO(monthStart);
    const endISO = toISO(monthEnd);

    return events
      .filter(ev => ev.date >= startISO && ev.date <= endISO)
      .filter(ev => view.artist==="all" ? true : ev.artist === view.artist)
      .filter(ev => view.status.has(ev.status))
      .filter(ev => {
        if(!view.q) return true;
        const hay = `${ev.title} ${ev.place} ${ev.artist} ${ev.status}`.toLowerCase();
        return hay.includes(view.q);
      }).length;
  }

  // ====== Modal ======
  function openModal(){
    // prefill date with today
    document.getElementById("m_date").value = toISO(new Date());
    document.getElementById("modal").style.display="flex";
  }
  function closeModal(){
    document.getElementById("modal").style.display="none";
    // reset
    ["m_title","m_time","m_place","m_notes"].forEach(id=>document.getElementById(id).value="");
    document.getElementById("m_status").value="CONFIRMADO";
    document.getElementById("m_artist").value=ARTISTS[0].id;
  }

  // ====== Month nav ======
  function shiftMonth(delta){
    const d = new Date(view.year, view.month+delta, 1);
    view.year = d.getFullYear();
    view.month = d.getMonth();
    render();
  }

  // ====== Utils ======
  function uid(){ return Math.random().toString(16).slice(2) + Date.now().toString(16); }
  function toISO(d){
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }
  function addDaysISO(n){
    const d = new Date();
    d.setDate(d.getDate()+n);
    return toISO(d);
  }
  function fmt(iso){
    try{
      const [y,m,d] = iso.split("-").map(Number);
      return new Date(y,m-1,d).toLocaleDateString("pt-BR");
    }catch{ return iso; }
  }
  function cap(s){ return s ? s[0].toUpperCase()+s.slice(1) : s; }
  function esc(s){
    return String(s??"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
  }
  function escAttr(s){
    return esc(s).replace(/"/g,"&quot;");
  }

  // initial
  render();
</script>
</body>
</html>
