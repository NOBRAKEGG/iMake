<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Agenda | OFF Company</title>

<style>
  @font-face{
    font-family:"Rokiest";
    src:url("https://waycompanygg.github.io/roteiro/assets/fonts/Rokiest-Extrabold.otf") format("opentype");
    font-weight:800; font-display:swap;
  }
  :root{
    --bg1:#050510; --bg2:#0b0a1a;
    --panel:rgba(10,10,22,.72);
    --stroke:rgba(255,255,255,.10);
    --text:#eef2ff;
    --muted:rgba(238,242,255,.65);

    --p1:#a855f7; /* roxo */
    --p2:#7c3aed; /* roxo escuro */
    --p3:#d946ef; /* pink neon */
    --p4:#22d3ee; /* cyan neon */
    --good:#22c55e;
    --warn:#f59e0b;
    --bad:#ef4444;

    --shadow:0 26px 90px rgba(0,0,0,.70);
    --glow: 0 0 0 1px rgba(255,255,255,.06), 0 22px 60px rgba(124,58,237,.18);
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color:var(--text);
    background:
      radial-gradient(900px 520px at 16% 12%, rgba(168,85,247,.24), transparent 60%),
      radial-gradient(900px 520px at 86% 18%, rgba(217,70,239,.16), transparent 60%),
      radial-gradient(900px 520px at 70% 90%, rgba(34,211,238,.12), transparent 60%),
      linear-gradient(135deg,var(--bg1),var(--bg2));
    padding:22px;
    display:flex;
    justify-content:center;
  }

  /* Home */
  .home{
    position:fixed; top:16px; left:16px;
    background:rgba(17,24,39,.92);
    border:1px solid rgba(255,255,255,.12);
    color:#fff; text-decoration:none;
    font-weight:900; font-size:14px;
    padding:10px 12px;
    border-radius:12px;
    box-shadow:0 12px 30px rgba(0,0,0,.45);
    transition:.15s;
    z-index:10;
  }
  .home:hover{transform:translateY(-1px); opacity:.92}

  .wrap{
    width:min(1250px,100%);
    background:var(--panel);
    border:1px solid var(--stroke);
    border-radius:26px;
    box-shadow:var(--shadow);
    padding:18px;
    backdrop-filter:blur(12px);
    animation: in .45s ease both;
    position:relative;
    overflow:hidden;
  }
  .wrap::before{
    content:"";
    position:absolute; inset:-2px;
    background:
      radial-gradient(600px 260px at 10% 18%, rgba(168,85,247,.16), transparent 60%),
      radial-gradient(600px 260px at 92% 12%, rgba(34,211,238,.10), transparent 60%);
    pointer-events:none;
    filter:saturate(1.2);
  }
  .wrap > *{position:relative}
  @keyframes in{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

  .topbar{
    display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;
    align-items:flex-end;
    padding:6px 6px 12px;
  }
  h1{
    font-family:"Rokiest";
    margin:0;
    letter-spacing:.9px;
    font-size:36px;
  }
  .sub{margin:6px 0 0; color:var(--muted); font-size:13px}

  .pill{
    display:inline-flex; gap:10px; align-items:center;
    padding:9px 12px;
    border:1px solid rgba(255,255,255,.10);
    border-radius:999px;
    background:rgba(255,255,255,.04);
    color:rgba(238,242,255,.78);
    font-size:12px; font-weight:900;
    box-shadow: var(--glow);
  }

  /* Layout */
  .grid{
    display:grid;
    grid-template-columns: 1.2fr .8fr;
    gap:12px;
    margin-top:10px;
  }
  @media(max-width: 1050px){ .grid{grid-template-columns:1fr} }

  .card{
    background:rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.10);
    border-radius:20px;
    padding:14px;
    box-shadow: var(--glow);
    overflow:hidden;
    position:relative;
  }
  .card::after{
    content:"";
    position:absolute; inset:-120px;
    background: conic-gradient(from 160deg, rgba(168,85,247,.16), rgba(34,211,238,.12), rgba(217,70,239,.14), rgba(168,85,247,.16));
    filter:blur(26px);
    opacity:.35;
    animation: swirl 8s linear infinite;
    pointer-events:none;
  }
  @keyframes swirl{to{transform:rotate(360deg)}}
  .card > *{position:relative}

  .cardTitle{
    font-family:"Rokiest";
    letter-spacing:.6px;
    font-size:18px;
    margin:0 0 10px;
  }

  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .divider{height:1px; background:rgba(255,255,255,.08); margin:12px 0}

  .btn{
    height:42px; border-radius:14px; border:0;
    padding:0 14px; font-weight:900;
    cursor:pointer; color:#fff;
    transition:.15s;
    display:inline-flex; align-items:center; justify-content:center; gap:10px;
    user-select:none;
    position:relative;
    overflow:hidden;
  }
  .btn:hover{transform:translateY(-1px); opacity:.96}
  .btn:active{transform:translateY(0); opacity:.90}

  .btnPrimary{
    background: linear-gradient(135deg, rgba(168,85,247,.95), rgba(217,70,239,.85));
    box-shadow: 0 14px 34px rgba(168,85,247,.18);
  }
  .btnGhost{
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
  }
  .btnNeon{
    background: rgba(34,211,238,.14);
    border:1px solid rgba(34,211,238,.30);
  }

  .btn::before{
    content:"";
    position:absolute; inset:0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,.16), transparent);
    transform: translateX(-120%);
    transition: transform .6s ease;
    opacity:.7;
  }
  .btn:hover::before{ transform: translateX(120%); }

  /* Inputs */
  label{font-size:12px; color:rgba(238,242,255,.72); font-weight:900}
  input, select, textarea{
    width:100%;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(2,6,23,.50);
    color: var(--text);
    padding: 10px 12px;
    outline:none;
    transition:.15s;
    font-size:14px;
  }
  input, select{height:42px}
  textarea{min-height:90px; resize:vertical}
  input:focus, select:focus, textarea:focus{
    border-color: rgba(168,85,247,.55);
    box-shadow: 0 0 0 4px rgba(168,85,247,.18);
  }
  .field{display:flex; flex-direction:column; gap:6px; flex:1 1 220px}
  .field.small{flex:0 0 160px}
  .field.mid{flex:0 0 220px}

  /* Calendar */
  .calHeader{
    display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
  }
  .monthTitle{
    display:flex; align-items:baseline; gap:10px; flex-wrap:wrap;
  }
  .monthTitle .m{
    font-family:"Rokiest";
    letter-spacing:.6px;
    font-size:22px;
  }
  .monthTitle .y{color:rgba(238,242,255,.65); font-weight:900}
  .calControls{display:flex; gap:8px; flex-wrap:wrap}

  .filters{
    display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;
  }

  .weekdays{
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap:10px;
    margin-top:12px;
    color:rgba(238,242,255,.70);
    font-size:12px;
    font-weight:900;
    letter-spacing:.2px;
    padding:0 4px;
  }
  .calGrid{
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap:10px;
    margin-top:10px;
  }
  .day{
    min-height:110px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(2,6,23,.36);
    padding:10px;
    position:relative;
    overflow:hidden;
    cursor:pointer;
    transition:.15s;
  }
  .day:hover{transform:translateY(-1px); border-color:rgba(168,85,247,.22)}
  .day.mutedDay{opacity:.45}
  .day.selected{outline: 2px solid rgba(34,211,238,.35); box-shadow: 0 0 0 6px rgba(34,211,238,.10)}
  .day::before{
    content:"";
    position:absolute; inset:-80px;
    background: radial-gradient(320px 160px at 20% 15%, rgba(168,85,247,.16), transparent 60%),
                radial-gradient(320px 160px at 90% 20%, rgba(217,70,239,.12), transparent 60%);
    opacity:.65;
    pointer-events:none;
  }
  .day > *{position:relative}
  .dayTop{
    display:flex; justify-content:space-between; align-items:center;
    font-weight:900; font-size:12px;
    color:rgba(238,242,255,.78);
  }
  .dot{
    width:8px; height:8px; border-radius:999px;
    background:rgba(255,255,255,.25);
    box-shadow: 0 0 0 3px rgba(255,255,255,.06);
  }

  .events{
    margin-top:8px;
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .event{
    border:1px solid rgba(255,255,255,.10);
    background: rgba(11,12,28,.60);
    border-radius:14px;
    padding:8px 10px;
    display:flex; gap:8px; align-items:center; justify-content:space-between;
    transition:.15s;
  }
  .event:hover{transform:translateY(-1px); border-color: rgba(34,211,238,.18)}
  .event .left{min-width:0}
  .event .t{
    font-size:12px; font-weight:900; letter-spacing:.2px;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .event .meta{
    margin-top:2px;
    font-size:11px;
    color:rgba(238,242,255,.65);
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .badge{
    font-size:11px; font-weight:900;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(255,255,255,.06);
    white-space:nowrap;
  }
  .bShow{ border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.12); }
  .bRes{ border-color: rgba(245,158,11,.35); background: rgba(245,158,11,.12); }
  .bPend{ border-color: rgba(168,85,247,.40); background: rgba(168,85,247,.14); }
  .bBlock{ border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.12); }

  /* Right panel list */
  .kpis{
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap:10px;
    margin-top:8px;
  }
  @media(max-width:650px){ .kpis{grid-template-columns:1fr 1fr} }
  .kpi{
    border:1px solid rgba(255,255,255,.10);
    background: rgba(2,6,23,.32);
    border-radius:18px;
    padding:12px;
    position:relative;
    overflow:hidden;
  }
  .kpi::before{
    content:"";
    position:absolute; inset:0;
    background: radial-gradient(260px 120px at 20% 20%, rgba(168,85,247,.18), transparent 60%);
    opacity:.7;
    pointer-events:none;
  }
  .kpi > *{position:relative}
  .kpi .t{font-size:12px; color:rgba(238,242,255,.65); font-weight:900}
  .kpi .v{font-size:20px; font-weight:900; margin-top:6px}

  .dayList{
    display:flex; flex-direction:column; gap:10px;
    margin-top:10px;
  }
  .dayItem{
    border:1px solid rgba(255,255,255,.10);
    background: rgba(2,6,23,.34);
    border-radius:18px;
    padding:12px;
    display:flex; justify-content:space-between; gap:10px; align-items:center;
    cursor:pointer;
    transition:.15s;
  }
  .dayItem:hover{transform:translateY(-1px)}
  .dayItem .name{font-weight:900}
  .dayItem .mini{color:rgba(238,242,255,.65); font-size:12px; margin-top:4px}
  .empty{
    border:1px dashed rgba(255,255,255,.18);
    background: rgba(2,6,23,.16);
    border-radius:18px;
    padding:14px;
    color:rgba(238,242,255,.78);
  }

  /* Modal / Drawer */
  .overlay{
    position:fixed; inset:0;
    display:none;
    align-items:flex-end;
    justify-content:center;
    background: rgba(0,0,0,.62);
    backdrop-filter: blur(12px);
    z-index:99999;
    padding:18px;
  }
  .drawer{
    width:min(980px, 100%);
    border-radius:22px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(10,10,22,.92);
    box-shadow: 0 28px 90px rgba(0,0,0,.72);
    padding:14px;
    animation: up .22s ease both;
    max-height: 86vh;
    overflow:auto;
  }
  @keyframes up{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
  .drawerTop{
    display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;
  }
  .drawerTitle{
    font-family:"Rokiest";
    letter-spacing:.6px;
    font-size:20px;
  }
  .x{
    height:40px; width:40px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    color:#fff;
    cursor:pointer;
    font-weight:900;
    transition:.15s;
  }
  .x:hover{transform:translateY(-1px); opacity:.95}

  .twoCols{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:12px;
    margin-top:12px;
  }
  @media(max-width:900px){ .twoCols{grid-template-columns:1fr} }

  .footer{
    margin-top:14px;
    padding:10px 6px 0;
    color:rgba(238,242,255,.55);
    font-size:12px;
    display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
  }

  /* Toast */
  .toast{
    position:fixed; bottom:18px; left:50%;
    transform:translateX(-50%);
    background:rgba(17,24,39,.95);
    border:1px solid rgba(255,255,255,.12);
    padding:10px 12px;
    border-radius:12px;
    font-weight:900;
    opacity:0; pointer-events:none;
    transition:.2s;
    z-index: 100000;
    box-shadow:0 12px 30px rgba(0,0,0,.45);
  }
  .toast.show{opacity:1}
</style>
</head>

<body>
<a class="home" href="index.html">üè† Home</a>

<div class="wrap">
  <div class="topbar">
    <div>
      <h1>Agenda</h1>
      <div class="sub">OFF Company ‚Ä¢ Gest√£o visual de compromissos (beta visual)</div>
    </div>
    <div class="row">
      <span class="pill">‚ú® Roxo Neon ‚Ä¢ Animado</span>
      <button class="btn btnPrimary" onclick="openNew()">Ôºã Novo compromisso</button>
    </div>
  </div>

  <div class="grid">
    <!-- CALEND√ÅRIO -->
    <div class="card">
      <div class="calHeader">
        <div class="monthTitle">
          <div class="m" id="monthName">M√™s</div>
          <div class="y" id="yearNum">0000</div>
        </div>
        <div class="calControls">
          <button class="btn btnGhost" onclick="prevMonth()">‚óÄ</button>
          <button class="btn btnGhost" onclick="goToday()">Hoje</button>
          <button class="btn btnGhost" onclick="nextMonth()">‚ñ∂</button>
        </div>
      </div>

      <div class="filters">
        <div class="field mid">
          <label>Artista</label>
          <select id="fArtist" onchange="renderAll()">
            <option value="ALL">Todos</option>
            <option>Matheusinho</option>
            <option>Mumuzinho</option>
            <option>OFF</option>
          </select>
        </div>
        <div class="field mid">
          <label>Status</label>
          <select id="fStatus" onchange="renderAll()">
            <option value="ALL">Todos</option>
            <option value="SHOW">Show</option>
            <option value="RESERVADO">Reservado</option>
            <option value="PENDENTE">Pendente</option>
            <option value="BLOQUEADO">Bloqueado</option>
          </select>
        </div>
        <div class="field small">
          <label>&nbsp;</label>
          <button class="btn btnNeon" onclick="seedDemo()">‚ö° Demo</button>
        </div>
      </div>

      <div class="weekdays">
        <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
      </div>

      <div id="calGrid" class="calGrid"></div>
    </div>

    <!-- PAINEL DO DIA -->
    <div class="card">
      <div class="row" style="justify-content:space-between; align-items:flex-end">
        <div>
          <div class="cardTitle" style="margin:0">Resumo do dia</div>
          <div class="sub" id="selectedLabel">Selecione um dia</div>
        </div>
        <button class="btn btnGhost" onclick="renderAll()">üîÑ</button>
      </div>

      <div class="kpis">
        <div class="kpi"><div class="t">Total</div><div class="v" id="kTotal">0</div></div>
        <div class="kpi"><div class="t">Show</div><div class="v" id="kShow">0</div></div>
        <div class="kpi"><div class="t">Reservado</div><div class="v" id="kRes">0</div></div>
        <div class="kpi"><div class="t">Pendente</div><div class="v" id="kPend">0</div></div>
      </div>

      <div class="divider"></div>

      <div id="dayList" class="dayList"></div>
    </div>
  </div>

  <div class="footer">
    <div>¬© OFF Company</div>
    <div>Desenvolvido por Lucas Santos</div>
  </div>
</div>

<!-- DRAWER -->
<div id="overlay" class="overlay" onclick="overlayClick(event)">
  <div class="drawer">
    <div class="drawerTop">
      <div>
        <div class="drawerTitle" id="drawerTitle">Novo compromisso</div>
        <div class="sub" id="drawerSub">Preencha os dados (visual)</div>
      </div>
      <button class="x" onclick="closeDrawer()">‚úñ</button>
    </div>

    <div class="divider"></div>

    <div class="twoCols">
      <div class="card" style="box-shadow:none">
        <div class="cardTitle">Detalhes do evento</div>

        <div class="row">
          <div class="field mid">
            <label>Data</label>
            <input id="eDate" type="date">
          </div>
          <div class="field small">
            <label>Hora</label>
            <input id="eTime" type="time" value="21:00">
          </div>
          <div class="field mid">
            <label>Status</label>
            <select id="eStatus">
              <option value="SHOW">Show</option>
              <option value="RESERVADO">Reservado</option>
              <option value="PENDENTE">Pendente</option>
              <option value="BLOQUEADO">Bloqueado</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div class="field">
            <label>Artista</label>
            <select id="eArtist">
              <option>Matheusinho</option>
              <option>Mumuzinho</option>
              <option>OFF</option>
            </select>
          </div>
          <div class="field">
            <label>T√≠tulo</label>
            <input id="eTitle" placeholder="Ex: Show em SP / Evento privado">
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div class="field">
            <label>Endere√ßo</label>
            <input id="eAddress" placeholder="Rua, n√∫mero, bairro">
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div class="field mid">
            <label>Cidade</label>
            <input id="eCity" placeholder="S√£o Paulo">
          </div>
          <div class="field mid">
            <label>Local</label>
            <input id="ePlace" placeholder="Casa de show / Evento">
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div class="field">
            <label>Observa√ß√µes</label>
            <textarea id="eNotes" placeholder="Roteiro, check-in, exig√™ncias, etc."></textarea>
          </div>
        </div>
      </div>

      <div class="card" style="box-shadow:none">
        <div class="cardTitle">Contratante & contrato</div>

        <div class="row">
          <div class="field">
            <label>Nome do contratante</label>
            <input id="cName" placeholder="Nome completo">
          </div>
          <div class="field">
            <label>Telefone / WhatsApp</label>
            <input id="cPhone" placeholder="(11) 99999-9999">
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div class="field">
            <label>Email</label>
            <input id="cEmail" placeholder="email@exemplo.com">
          </div>
          <div class="field mid">
            <label>Contrato enviado?</label>
            <select id="cContractSent">
              <option value="NAO">N√£o</option>
              <option value="SIM">Sim</option>
            </select>
          </div>
          <div class="field mid">
            <label>Pago?</label>
            <select id="cPaid">
              <option value="NAO">N√£o</option>
              <option value="SIM">Sim</option>
            </select>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row" style="justify-content:space-between">
          <button class="btn btnGhost" onclick="deleteEvent()">üóëÔ∏è Excluir</button>
          <div class="row">
            <button class="btn btnGhost" onclick="closeDrawer()">Cancelar</button>
            <button class="btn btnPrimary" onclick="saveEvent()">Salvar</button>
          </div>
        </div>

        <div class="sub" style="margin-top:10px;">
          * Por enquanto salva s√≥ no seu navegador (LocalStorage). Depois a gente liga com planilha/API.
        </div>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast">‚úÖ</div>

<script>
  // =================== STATE ===================
  const LS_KEY = "OFF_AGENDA_EVENTS_V1";
  let viewDate = new Date(); // m√™s exibido
  let selected = ymd(new Date()); // dia selecionado
  let editingId = null;

  // =================== UTIL ===================
  function toast(msg){
    const t=document.getElementById("toast");
    t.textContent=msg;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"), 1600);
  }
  function ymd(d){
    const x = new Date(d);
    const y = x.getFullYear();
    const m = String(x.getMonth()+1).padStart(2,"0");
    const da = String(x.getDate()).padStart(2,"0");
    return `${y}-${m}-${da}`;
  }
  function parseYMD(s){
    const [y,m,d]=String(s).split("-").map(n=>parseInt(n,10));
    return new Date(y,(m-1),d);
  }
  function monthLabel(d){
    return d.toLocaleDateString("pt-BR",{month:"long"});
  }
  function uid(){
    return "E" + Math.random().toString(16).slice(2) + Date.now().toString(16);
  }

  function getAll(){
    try{ return JSON.parse(localStorage.getItem(LS_KEY) || "[]") || []; }
    catch{ return []; }
  }
  function setAll(arr){
    localStorage.setItem(LS_KEY, JSON.stringify(arr||[]));
  }

  // =================== FILTERS ===================
  function getFilters(){
    const artist = document.getElementById("fArtist").value;
    const status = document.getElementById("fStatus").value;
    return { artist, status };
  }
  function applyFilters(arr){
    const {artist,status} = getFilters();
    return (arr||[]).filter(e=>{
      if(artist !== "ALL" && e.artist !== artist) return false;
      if(status !== "ALL" && e.status !== status) return false;
      return true;
    });
  }

  // =================== CALENDAR RENDER ===================
  function renderAll(){
    renderHeader();
    renderCalendar();
    renderDayPanel();
  }

  function renderHeader(){
    document.getElementById("monthName").textContent = cap(monthLabel(viewDate));
    document.getElementById("yearNum").textContent = String(viewDate.getFullYear());
  }
  function cap(s){ return (s||"").charAt(0).toUpperCase() + (s||"").slice(1); }

  function renderCalendar(){
    const grid = document.getElementById("calGrid");
    const y = viewDate.getFullYear();
    const m = viewDate.getMonth();

    const first = new Date(y,m,1);
    const startDay = first.getDay(); // 0=dom
    const daysInMonth = new Date(y,m+1,0).getDate();

    const prevDays = startDay;
    const prevMonthDays = new Date(y,m,0).getDate();
    const cells = [];

    // Prev month trailing
    for(let i=prevDays;i>0;i--){
      const d = new Date(y,m,1 - i);
      cells.push({ date: d, muted:true });
    }
    // Current month
    for(let i=1;i<=daysInMonth;i++){
      cells.push({ date: new Date(y,m,i), muted:false });
    }
    // Next month leading to complete 6 rows (42 cells)
    while(cells.length < 42){
      const d = new Date(y,m,daysInMonth + (cells.length - (prevDays + daysInMonth)) + 1);
      cells.push({ date: d, muted:true });
    }

    const all = applyFilters(getAll());
    const mapByDay = {};
    for(const e of all){
      (mapByDay[e.date] ||= []).push(e);
    }

    grid.innerHTML = cells.map(c=>{
      const dkey = ymd(c.date);
      const isSel = dkey === selected;
      const dayEvents = (mapByDay[dkey] || []).slice(0,2);

      const dotColor = (mapByDay[dkey]||[]).length
        ? "style='background:rgba(168,85,247,.85); box-shadow:0 0 0 3px rgba(168,85,247,.12)'"
        : "";

      const evHtml = dayEvents.map(e=>eventChip(e)).join("");
      const more = (mapByDay[dkey]||[]).length > 2 ? `<div class="sub" style="margin-top:6px">+${(mapByDay[dkey].length-2)} mais</div>` : "";

      return `
        <div class="day ${c.muted?"mutedDay":""} ${isSel?"selected":""}"
             onclick="selectDay('${dkey}')">
          <div class="dayTop">
            <div>${c.date.getDate()}</div>
            <div class="dot" ${dotColor}></div>
          </div>
          <div class="events">
            ${evHtml}
            ${more}
          </div>
        </div>
      `;
    }).join("");
  }

  function badgeClass(status){
    switch(status){
      case "SHOW": return "bShow";
      case "RESERVADO": return "bRes";
      case "PENDENTE": return "bPend";
      case "BLOQUEADO": return "bBlock";
      default: return "bPend";
    }
  }
  function badgeText(status){
    switch(status){
      case "SHOW": return "Show";
      case "RESERVADO": return "Reservado";
      case "PENDENTE": return "Pendente";
      case "BLOQUEADO": return "Bloqueado";
      default: return status;
    }
  }
  function eventChip(e){
    const st = String(e.status||"PENDENTE").toUpperCase();
    const title = esc(e.title || "(Sem t√≠tulo)");
    const artist = esc(e.artist || "‚Äî");
    const time = esc(e.time || "");
    return `
      <div class="event" onclick="openEvent(event,'${e.id}')">
        <div class="left">
          <div class="t">${title}</div>
          <div class="meta">${artist}${time ? " ‚Ä¢ " + time : ""}</div>
        </div>
        <div class="badge ${badgeClass(st)}">${badgeText(st)}</div>
      </div>
    `;
  }

  function selectDay(dkey){
    selected = dkey;
    renderAll();
  }

  // =================== DAY PANEL ===================
  function renderDayPanel(){
    const label = document.getElementById("selectedLabel");
    const d = parseYMD(selected);
    label.textContent = d.toLocaleDateString("pt-BR",{weekday:"long", day:"2-digit", month:"long", year:"numeric"});

    const all = applyFilters(getAll()).filter(e=>e.date === selected);
    const total = all.length;
    const show = all.filter(e=>e.status==="SHOW").length;
    const res  = all.filter(e=>e.status==="RESERVADO").length;
    const pend = all.filter(e=>e.status==="PENDENTE").length;

    document.getElementById("kTotal").textContent = total;
    document.getElementById("kShow").textContent  = show;
    document.getElementById("kRes").textContent   = res;
    document.getElementById("kPend").textContent  = pend;

    const list = document.getElementById("dayList");
    if(!all.length){
      list.innerHTML = `<div class="empty"><b>Nenhum compromisso nesse dia.</b><div class="sub" style="margin-top:6px">Clique no dia no calend√°rio ou em ‚ÄúNovo compromisso‚Äù.</div></div>`;
      return;
    }

    // ordena por hora
    all.sort((a,b)=>String(a.time||"").localeCompare(String(b.time||"")));
    list.innerHTML = all.map(e=>`
      <div class="dayItem" onclick="openEvent(event,'${e.id}')">
        <div style="min-width:0">
          <div class="name">${esc(e.title || "(Sem t√≠tulo)")}</div>
          <div class="mini">${esc(e.artist||"‚Äî")} ‚Ä¢ ${badgeText(e.status)}${e.time?(" ‚Ä¢ " + esc(e.time)):""}</div>
        </div>
        <span class="badge ${badgeClass(e.status)}">${badgeText(e.status)}</span>
      </div>
    `).join("");
  }

  // =================== DRAWER ===================
  function openNew(){
    editingId = null;
    openDrawer();
    fillForm({
      date: selected,
      time:"21:00",
      status:"PENDENTE",
      artist:"Matheusinho",
      title:"",
      address:"",
      city:"",
      place:"",
      notes:"",
      contractorName:"",
      contractorPhone:"",
      contractorEmail:"",
      contractSent:"NAO",
      paid:"NAO",
    });
    document.getElementById("drawerTitle").textContent = "Novo compromisso";
  }

  function openEvent(ev, id){
    ev.stopPropagation();
    const all = getAll();
    const found = all.find(x=>x.id===id);
    if(!found) return toast("Evento n√£o encontrado");
    editingId = id;
    openDrawer();
    fillForm(found);
    document.getElementById("drawerTitle").textContent = "Gerenciar compromisso";
  }

  function openDrawer(){
    document.getElementById("overlay").style.display="flex";
  }
  function closeDrawer(){
    document.getElementById("overlay").style.display="none";
  }
  function overlayClick(e){
    if(e.target && e.target.id==="overlay") closeDrawer();
  }

  function fillForm(e){
    document.getElementById("eDate").value = e.date || selected;
    document.getElementById("eTime").value = e.time || "";
    document.getElementById("eStatus").value = e.status || "PENDENTE";
    document.getElementById("eArtist").value = e.artist || "Matheusinho";
    document.getElementById("eTitle").value = e.title || "";
    document.getElementById("eAddress").value = e.address || "";
    document.getElementById("eCity").value = e.city || "";
    document.getElementById("ePlace").value = e.place || "";
    document.getElementById("eNotes").value = e.notes || "";

    document.getElementById("cName").value = e.contractorName || "";
    document.getElementById("cPhone").value = e.contractorPhone || "";
    document.getElementById("cEmail").value = e.contractorEmail || "";
    document.getElementById("cContractSent").value = e.contractSent || "NAO";
    document.getElementById("cPaid").value = e.paid || "NAO";
  }

  function readForm(){
    return {
      date: document.getElementById("eDate").value || selected,
      time: document.getElementById("eTime").value || "",
      status: document.getElementById("eStatus").value || "PENDENTE",
      artist: document.getElementById("eArtist").value || "Matheusinho",
      title: document.getElementById("eTitle").value || "",
      address: document.getElementById("eAddress").value || "",
      city: document.getElementById("eCity").value || "",
      place: document.getElementById("ePlace").value || "",
      notes: document.getElementById("eNotes").value || "",

      contractorName: document.getElementById("cName").value || "",
      contractorPhone: document.getElementById("cPhone").value || "",
      contractorEmail: document.getElementById("cEmail").value || "",
      contractSent: document.getElementById("cContractSent").value || "NAO",
      paid: document.getElementById("cPaid").value || "NAO",
    };
  }

  function saveEvent(){
    const data = readForm();
    if(!data.date) return toast("Defina uma data");
    if(!data.title.trim()) data.title = "(Sem t√≠tulo)";

    const all = getAll();

    if(editingId){
      const idx = all.findIndex(x=>x.id===editingId);
      if(idx>=0){
        all[idx] = { ...all[idx], ...data };
      }
      setAll(all);
      toast("‚úÖ Atualizado");
    }else{
      const e = { id: uid(), ...data };
      all.push(e);
      setAll(all);
      toast("‚úÖ Criado");
    }

    selected = data.date;
    viewDate = parseYMD(data.date);
    closeDrawer();
    renderAll();
  }

  function deleteEvent(){
    if(!editingId) return toast("Nada para excluir");
    const all = getAll().filter(x=>x.id!==editingId);
    setAll(all);
    toast("üóëÔ∏è Exclu√≠do");
    editingId = null;
    closeDrawer();
    renderAll();
  }

  // =================== NAV MONTH ===================
  function prevMonth(){
    viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()-1, 1);
    renderAll();
  }
  function nextMonth(){
    viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()+1, 1);
    renderAll();
  }
  function goToday(){
    const t = new Date();
    viewDate = new Date(t.getFullYear(), t.getMonth(), 1);
    selected = ymd(t);
    renderAll();
  }

  // =================== DEMO ===================
  function seedDemo(){
    const base = parseYMD(selected);
    const d1 = ymd(base);
    const d2 = ymd(new Date(base.getFullYear(), base.getMonth(), base.getDate()+2));
    const d3 = ymd(new Date(base.getFullYear(), base.getMonth(), base.getDate()+5));

    const demo = [
      { id: uid(), date:d1, time:"22:00", status:"RESERVADO", artist:"Matheusinho", title:"Evento privado", city:"S√£o Paulo", place:"Buffet", address:"Rua X, 123",
        contractorName:"Carlos", contractorPhone:"(11) 90000-0000", contractorEmail:"carlos@email.com", contractSent:"NAO", paid:"NAO", notes:"Aguardando confirma√ß√£o." },
      { id: uid(), date:d2, time:"20:30", status:"SHOW", artist:"Mumuzinho", title:"Casa de show", city:"Rio de Janeiro", place:"Arena", address:"Av Y, 777",
        contractorName:"Ana", contractorPhone:"(21) 98888-8888", contractorEmail:"ana@email.com", contractSent:"SIM", paid:"SIM", notes:"Passagem ok. Hotel ok." },
      { id: uid(), date:d3, time:"19:00", status:"PENDENTE", artist:"OFF", title:"Reuni√£o/Proposta", city:"Online", place:"Meet", address:"",
        contractorName:"Bruno", contractorPhone:"", contractorEmail:"", contractSent:"NAO", paid:"NAO", notes:"Alinhar budget e rider." }
    ];

    const all = getAll();
    setAll(all.concat(demo));
    toast("‚ö° Demo criada");
    renderAll();
  }

  function esc(s){
    return String(s??"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
  }

  // =================== INIT ===================
  window.addEventListener("DOMContentLoaded", ()=>{
    // se quiser iniciar vazio, n√£o faz nada.
    // seleciona hoje e renderiza
    goToday();
  });

  // exp√µe fun√ß√µes pro HTML
  window.prevMonth = prevMonth;
  window.nextMonth = nextMonth;
  window.goToday = goToday;
  window.renderAll = renderAll;
  window.selectDay = selectDay;
  window.openNew = openNew;
  window.openEvent = openEvent;
  window.closeDrawer = closeDrawer;
  window.overlayClick = overlayClick;
  window.saveEvent = saveEvent;
  window.deleteEvent = deleteEvent;
  window.seedDemo = seedDemo;
</script>
</body>
</html>
