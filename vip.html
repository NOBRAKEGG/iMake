<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Lista VIP | OFF Company</title>

  <style>
    @font-face{
      font-family:"Rokiest";
      src:url("https://waycompanygg.github.io/roteiro/assets/fonts/Rokiest-Extrabold.otf") format("opentype");
      font-weight:800;
      font-display:swap;
    }

    :root{
      --bg1:#050611; --bg2:#0b1220;
      --panel: rgba(10,16,28,.66);
      --panel2: rgba(2,6,23,.35);
      --stroke: rgba(255,255,255,.10);
      --text:#e5e7eb;
      --muted: rgba(229,231,235,.62);
      --shadow: 0 26px 90px rgba(0,0,0,.72);

      --purple:#8b5cf6;
      --cyan:#06b6d4;
      --green:#22c55e;
      --amber:#f59e0b;
      --red:#ef4444;

      --r: 22px;
      --r2: 18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      background:
        radial-gradient(900px 520px at 14% 12%, rgba(139,92,246,.18), transparent 60%),
        radial-gradient(900px 520px at 86% 18%, rgba(6,182,212,.14), transparent 60%),
        radial-gradient(900px 520px at 70% 90%, rgba(34,197,94,.10), transparent 60%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
      overflow-x:hidden;
    }

    .noise{
      pointer-events:none;
      position:fixed; inset:0;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
      opacity:.18;
      mix-blend-mode: overlay;
    }

    .shell{
      display:flex;
      min-height:100vh;
      gap:18px;
      padding:18px;
    }

    /* ===== sidebar ===== */
    .side{
      width:84px; flex:0 0 84px;
      position:sticky; top:18px; align-self:flex-start;
      height: calc(100vh - 36px);
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(10,16,28,.42);
      backdrop-filter: blur(14px);
      box-shadow: 0 18px 70px rgba(0,0,0,.55);
      padding:10px;
      display:flex; flex-direction:column; align-items:center; gap:10px;
      overflow:hidden;
    }

    .brandMark{
      width:58px; height:58px;
      border-radius: 18px;
      display:grid; place-items:center;
      font-family:"Rokiest";
      letter-spacing:.9px;
      background:
        radial-gradient(90px 90px at 30% 25%, rgba(139,92,246,.75), transparent 60%),
        radial-gradient(90px 90px at 78% 70%, rgba(6,182,212,.55), transparent 65%),
        rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 14px 40px rgba(0,0,0,.55);
      user-select:none;
    }

    .nav{
      width:100%;
      display:flex; flex-direction:column; gap:10px;
      align-items:center;
      margin-top:2px;
    }
    .nav a{
      width:58px; height:58px;
      border-radius: 20px;
      display:grid; place-items:center;
      text-decoration:none;
      color: rgba(229,231,235,.88);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      transition: .18s;
      position:relative;
      overflow:hidden;
    }
    .nav a:hover{
      transform: translateY(-1px);
      border-color: rgba(139,92,246,.25);
      background: rgba(139,92,246,.10);
    }
    .nav a.active{
      border-color: rgba(139,92,246,.35);
      background:
        radial-gradient(120px 120px at 30% 25%, rgba(139,92,246,.28), transparent 60%),
        radial-gradient(120px 120px at 80% 70%, rgba(6,182,212,.14), transparent 65%),
        rgba(255,255,255,.05);
      box-shadow: 0 18px 60px rgba(139,92,246,.14);
    }

    /* ===== main ===== */
    .main{
      flex:1 1 auto;
      min-width:0;
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.10);
      background: var(--panel);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
      overflow:hidden;
      animation: in .45s ease both;
    }
    @keyframes in{
      from{opacity:0; transform: translateY(10px)}
      to{opacity:1; transform: translateY(0)}
    }

    .topbar{
      padding:16px 16px 12px;
      display:flex;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      align-items:center;
    }
    .titleWrap{display:flex; flex-direction:column; gap:6px}
    .titleWrap h1{
      margin:0;
      font-family:"Rokiest";
      letter-spacing:.9px;
      font-size:42px;
      line-height:1;
    }
    .subtitle{color:var(--muted); font-size:13px}

    .topRight{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end}
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      color:rgba(229,231,235,.82);
      font-weight:900;
      font-size:12px;
      user-select:none;
    }

    .content{padding: 0 16px 16px}

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }

    .card{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(2,6,23,.28);
      border-radius: var(--r);
      padding:14px;
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(420px 200px at 10% 0%, rgba(139,92,246,.10), transparent 60%),
        radial-gradient(420px 200px at 90% 10%, rgba(6,182,212,.08), transparent 62%);
      pointer-events:none;
    }
    .card > *{position:relative}

    .cardHead{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom:12px;
    }
    .cardHead h2{margin:0; font-size:16px}
    .hint{color:rgba(229,231,235,.55); font-size:12px}

    /* ===== inputs / buttons ===== */
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:end}
    .field{display:flex; flex-direction:column; gap:6px; flex:1 1 260px}
    label{font-size:12px; color:rgba(229,231,235,.72)}
    input, select{
      height:46px; width:100%;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(2,6,23,.55);
      color: var(--text);
      padding: 10px 12px;
      outline:none;
      transition:.15s;
    }
    input:focus, select:focus{
      border-color: rgba(139,92,246,.55);
      box-shadow: 0 0 0 4px rgba(139,92,246,.18);
    }

    .btn{
      height:46px;
      border-radius:14px;
      border:0;
      padding:0 14px;
      font-weight:900;
      cursor:pointer;
      color:#fff;
      transition:.18s;
      white-space:nowrap;
    }
    .btn:hover{transform:translateY(-1px); opacity:.95}
    .btn:active{transform:translateY(0); opacity:.92}
    .btnPurple{
      background: linear-gradient(135deg, rgba(139,92,246,.95), rgba(6,182,212,.65));
      box-shadow: 0 16px 50px rgba(139,92,246,.18);
    }
    .btnGhost{
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      color:rgba(229,231,235,.90);
    }

    /* ===== slots grid ===== */
    .slotsGrid{
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap:10px;
      margin-top:12px;
    }
    @media(max-width:980px){ .slotsGrid{grid-template-columns: repeat(3, 1fr);} }
    @media(max-width:560px){ .slotsGrid{grid-template-columns: repeat(2, 1fr);} }

    .slot{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(2,6,23,.45);
      border-radius:18px;
      padding:12px;
      transition:.18s;
      min-height: 98px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      cursor:pointer;
      position:relative;
      overflow:hidden;
    }
    .slot:hover{transform:translateY(-2px); border-color: rgba(139,92,246,.22)}
    .slot:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(220px 160px at 20% 10%, rgba(139,92,246,.16), transparent 60%),
        radial-gradient(220px 160px at 90% 60%, rgba(6,182,212,.12), transparent 62%);
      opacity:.85;
      pointer-events:none;
    }
    .slot > *{position:relative}

    .topRow{display:flex; justify-content:space-between; align-items:center; gap:8px}
    .num{font-weight:900; color:rgba(229,231,235,.92)}
    .badge{
      font-size:12px; font-weight:900;
      padding:6px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      white-space:nowrap;
    }

    .bLivre{ border-color: rgba(34,197,94,.25); background: rgba(34,197,94,.08); }
    .bOcup{ border-color: rgba(245,158,11,.22); background: rgba(245,158,11,.08); }
    .bBloq{ border-color: rgba(239,68,68,.25); background: rgba(239,68,68,.08); }
    .bConf{ border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.16); }

    .name{
      margin-top:10px;
      font-size:13px;
      color: rgba(229,231,235,.68);
    }
    .blurName{ filter: blur(5px); opacity:.9; user-select:none; }

    /* ===== empty state ===== */
    .empty{
      border-radius: 18px;
      border:1px dashed rgba(255,255,255,.16);
      background: rgba(2,6,23,.22);
      padding:14px;
      color:rgba(229,231,235,.72);
    }
    .empty b{color:rgba(229,231,235,.92)}

    /* ===== overlays ===== */
    .overlay{
      position:fixed; inset:0;
      display:none;
      align-items:center; justify-content:center;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      z-index: 99999;
      padding: 18px;
    }
    .modal{
      width: min(640px, 96vw);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(11,18,32,.92);
      box-shadow: 0 20px 70px rgba(0,0,0,.70);
      padding: 16px;
      animation: pop .22s ease both;
      position:relative;
      overflow:hidden;
    }
    .modal:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(420px 220px at 10% 0%, rgba(139,92,246,.14), transparent 60%),
        radial-gradient(420px 220px at 90% 10%, rgba(6,182,212,.10), transparent 62%);
      pointer-events:none;
    }
    .modal > *{position:relative}

    @keyframes pop{from{opacity:0;transform:scale(.98)}to{opacity:1;transform:scale(1)}}

    .ring{
      width:56px; height:56px;
      border-radius:999px;
      border:3px solid rgba(255,255,255,.18);
      border-top-color:rgba(139,92,246,.95);
      margin:10px auto 12px;
      animation:spin .9s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .btnRow{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap}

    /* ===== toast ===== */
    .toast{
      position:fixed; bottom:18px; left:50%;
      transform:translateX(-50%);
      background: rgba(17,24,39,.95);
      border:1px solid rgba(255,255,255,.12);
      padding:10px 12px;
      border-radius:12px;
      font-weight:900;
      opacity:0; pointer-events:none;
      transition:.2s;
      z-index: 100000;
      box-shadow: 0 12px 30px rgba(0,0,0,.45);
      max-width: min(92vw, 720px);
      text-align:center;
    }
    .toast.show{opacity:1}

    .footer{
      padding:14px 16px 16px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      color:rgba(229,231,235,.55);
      font-size:12px;
      border-top:1px solid rgba(255,255,255,.06);
      background: rgba(2,6,23,.12);
    }
  </style>
</head>

<body>
  <div class="noise"></div>

  <div class="shell">
    <aside class="side">
      <div class="brandMark">OFF</div>

      <nav class="nav">
        <a href="index.html" title="Home">üè†</a>
        <a class="active" href="vip.html" title="Lista VIP">üéüÔ∏è</a>
        <a href="vip-admin.html" title="VIP Admin">üß†</a>
        <a href="pix.html" title="PIX">üí∏</a>
        <a href="pix-admin.html" title="PIX Admin">üõ°Ô∏è</a>
        <a href="pix-cadastro.html" title="Cadastro PIX">‚ûï</a>
        <a href="ajustar-cronograma.html" title="Cronograma">üóìÔ∏è</a>
        <a href="diaria.html" title="Di√°ria">üìí</a>
        <a href="van.html" title="Van">üöê</a>
      </nav>
    </aside>

    <main class="main">
      <div class="topbar">
        <div class="titleWrap">
          <h1>Lista VIP</h1>
          <div class="subtitle">Entre com o c√≥digo e reserve um slot. Voc√™ n√£o v√™ dados dos outros.</div>
        </div>

        <div class="topRight">
          <div class="pill">üéüÔ∏è VIP</div>
          <div class="pill" id="pillStatus">üü° Aguardando c√≥digo</div>
        </div>
      </div>

      <div class="content">
        <div class="grid">
          <section class="card">
            <div class="cardHead">
              <h2>Acesso por C√≥digo</h2>
              <div class="hint" id="infoLine">Cole um c√≥digo v√°lido para carregar seus slots.</div>
            </div>

            <div class="row">
              <div class="field">
                <label>C√≥digo de acesso</label>
                <input id="code" placeholder="Cole o c√≥digo (ex: A2F9KQ)" autocomplete="off"/>
              </div>
              <div class="field" style="flex:0 0 220px;">
                <label>&nbsp;</label>
                <button class="btn btnPurple" onclick="entrar()">Entrar</button>
              </div>
            </div>

            <div id="gridSlots" class="slotsGrid"></div>
            <div id="emptyBox" class="empty" style="display:none; margin-top:12px;">
              <b>Nenhum slot liberado</b>
              <div style="margin-top:6px; font-size:12px; color:rgba(229,231,235,.62)">
                Esse c√≥digo est√° v√°lido, mas ainda n√£o tem slots atribu√≠dos para ele.
              </div>
            </div>
          </section>
        </div>
      </div>

      <div class="footer">
        <div>¬© OFF Company</div>
        <div>Desenvolvido por Lucas Santos</div>
      </div>
    </main>
  </div>

  <!-- MODAL RESERVA -->
  <div id="overlay" class="overlay">
    <div class="modal">
      <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:10px;">
        <div>
          <div style="font-family:Rokiest; letter-spacing:.6px; font-size:22px;">
            Reservar slot <span id="slotNum"></span>
          </div>
          <div style="margin-top:6px; color:rgba(229,231,235,.65); font-size:13px;">
            Preencha seus dados. Outros usu√°rios n√£o veem suas informa√ß√µes.
          </div>
        </div>
        <button class="btn btnGhost" style="height:40px;" onclick="fechar()">‚úñ</button>
      </div>

      <div style="height:1px; background:rgba(255,255,255,.08); margin:12px 0;"></div>

      <div class="row">
        <div class="field"><label>Nome</label><input id="nome"></div>
        <div class="field"><label>RG</label><input id="rg"></div>
        <div class="field"><label>CPF</label><input id="cpf"></div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div class="field" style="flex:0 0 220px;">
          <label>Vai de ve√≠culo?</label>
          <select id="veiculo" onchange="toggleVeiculo()">
            <option value="NAO">N√£o</option>
            <option value="SIM">Sim</option>
          </select>
        </div>
        <div class="field"><label>Placa</label><input id="placa" disabled></div>
        <div class="field"><label>Cor</label><input id="cor" disabled></div>
        <div class="field"><label>Modelo</label><input id="modelo" disabled></div>
      </div>

      <div class="btnRow">
        <button class="btn btnGhost" onclick="fechar()">Cancelar</button>
        <button class="btn btnPurple" onclick="confirmar()">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- OVERLAY LOADER -->
  <div id="loading" class="overlay">
    <div class="modal" style="text-align:center">
      <div class="ring"></div>
      <div style="font-family:Rokiest; font-size:22px; letter-spacing:.6px;">Carregando‚Ä¶</div>
      <div style="margin-top:6px; color:rgba(229,231,235,.65); font-size:13px;">Aguarde</div>
    </div>
  </div>

  <div id="toast" class="toast">‚úÖ</div>

  <script>
    // ====== CONFIG ======
    const API_URL = "https://script.google.com/macros/s/AKfycbyyU0eLff_-CRNBi6G_BfjGZA9G3kEylVHuhM0N9HqNFD2vsR8A2NeF_g0jV921Q4MG/exec";

    let currentSlots = [];
    let selectedSlot = null;
    let pollTimer = null;

    let lastToast = "";
    let lastEmptyShown = false;

    function setStatusPill(text){
      const el = document.getElementById("pillStatus");
      if(el) el.textContent = text;
    }

    function setInfoLine(text){
      const el = document.getElementById("infoLine");
      if(el) el.textContent = text;
    }

    function toast(msg, force=false){
      if(!force && msg === lastToast) return;
      lastToast = msg;

      const t = document.getElementById("toast");
      if(!t){ alert(msg); return; }
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(()=>t.classList.remove("show"), 1700);
    }

    function loading(on){
      const el = document.getElementById("loading");
      if(el) el.style.display = on ? "flex" : "none";
    }

    function showOverlay(on){
      const el = document.getElementById("overlay");
      if(el) el.style.display = on ? "flex" : "none";
    }

    function normalizeCode(s){
      s = String(s||"").trim().toUpperCase();
      const m = s.match(/[A-Z0-9]{4,12}/);
      return m ? m[0] : "";
    }

    function toggleVeiculo(){
      const yes = document.getElementById("veiculo").value === "SIM";
      ["placa","cor","modelo"].forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        el.disabled = !yes;
        if(!yes) el.value = "";
      });
    }

    async function api(fn, payload){
      const controller = new AbortController();
      const timeout = setTimeout(()=>controller.abort(), 20000);

      try{
        const res = await fetch(API_URL, {
          method: "POST",
          cache: "no-store",
          body: JSON.stringify({ fn, payload }),
          signal: controller.signal
        });

        const text = await res.text();
        try { return JSON.parse(text); }
        catch { return { ok:false, error:"Resposta inv√°lida da API (n√£o √© JSON)" }; }

      } catch (err){
        return { ok:false, error:(err.name==="AbortError" ? "Timeout da API" : "Falha de conex√£o") };
      } finally {
        clearTimeout(timeout);
      }
    }

    function renderGrid(){
      const grid = document.getElementById("gridSlots");
      const empty = document.getElementById("emptyBox");
      if(!grid) return;

      const hasSlots = (currentSlots && currentSlots.length > 0);
      grid.style.display = hasSlots ? "grid" : "none";
      empty.style.display = hasSlots ? "none" : "block";

      if(!hasSlots){
        // n√£o flodar
        if(!lastEmptyShown){
          toast("‚ÑπÔ∏è Nenhum slot liberado", true);
          lastEmptyShown = true;
        }
        return;
      }
      lastEmptyShown = false;

      grid.innerHTML = currentSlots.map(s=>{
        const status = String(s.status||"LIVRE").toUpperCase();

        const cls =
          status==="LIVRE" ? "bLivre" :
          status==="BLOQUEADO" ? "bBloq" :
          status==="CONFIRMADO" ? "bConf" : "bOcup";

        const badge =
          status==="LIVRE" ? "Livre" :
          status==="BLOQUEADO" ? "Bloqueado" :
          status==="CONFIRMADO" ? "Confirmado" : "Ocupado";

        const codeChip = (s.codeTag && (status==="OCUPADO" || status==="CONFIRMADO"))
          ? `<span class="badge" style="margin-left:8px; opacity:.95">${escapeHtml(s.codeTag)}</span>`
          : "";

        const name =
          (status==="OCUPADO" || status==="CONFIRMADO")
            ? `<div class="name blurName">${escapeHtml(s.nomeMasked||"Ocupado")}</div>`
            : `<div class="name">‚Äî</div>`;

        const click = status==="LIVRE" ? `onclick="clickSlot('${escapeJs(s.slot)}','${status}')"` : `onclick="clickSlot('${escapeJs(s.slot)}','${status}')"`; // mant√©m toast

        return `
          <div class="slot ${cls}" ${click}>
            <div class="topRow">
              <div class="num">#${escapeHtml(s.slot)}</div>
              <div style="display:flex; gap:8px; align-items:center;">
                <div class="badge">${badge}</div>
                ${codeChip}
              </div>
            </div>
            ${name}
          </div>
        `;
      }).join("");
    }

    function clickSlot(slot, status){
      if(status !== "LIVRE"){
        return toast(
          status==="BLOQUEADO" ? "‚õî Slot bloqueado" :
          status==="CONFIRMADO" ? "‚úÖ Slot confirmado" :
          "‚ö†Ô∏è Slot ocupado"
        );
      }
      selectedSlot = slot;
      document.getElementById("slotNum").textContent = "#" + slot;
      showOverlay(true);
    }

    function fechar(){
      showOverlay(false);
      selectedSlot = null;
    }

    async function entrar(){
      const raw = document.getElementById("code").value || "";
      const code = normalizeCode(raw);
      if(!code) return toast("Digite um c√≥digo v√°lido", true);

      document.getElementById("code").value = code;

      setStatusPill("üü° Validando‚Ä¶");
      setInfoLine("Validando seu c√≥digo e carregando slots‚Ä¶");

      loading(true);
      const r = await api("vipPublicGet", { code });
      loading(false);

      if(!r.ok){
        setStatusPill("üî¥ C√≥digo inv√°lido");
        setInfoLine("N√£o foi poss√≠vel carregar. Verifique o c√≥digo.");
        return toast("‚ùå " + r.error, true);
      }

      currentSlots = r.slots || [];
      renderGrid();

      const total = currentSlots.length;
      setStatusPill("üü¢ Acesso liberado");
      setInfoLine(`C√≥digo: ${r.code || code} ‚Ä¢ slots deste c√≥digo: ${total}`);

      // Toast s√≥ 1 vez
      toast("‚úÖ Acesso liberado", true);

      // Auto refresh
      if(pollTimer) clearInterval(pollTimer);
      pollTimer = setInterval(async ()=>{
        const c = normalizeCode(document.getElementById("code").value || "");
        if(!c) return;
        const rr = await api("vipPublicGet", { code: c });
        if(rr.ok){
          currentSlots = rr.slots || [];
          renderGrid();
          // n√£o spammar status/toast
        }
      }, 4000);
    }

    async function confirmar(){
      const code = normalizeCode(document.getElementById("code").value || "");
      if(!code) return toast("C√≥digo inv√°lido", true);

      const nome = (document.getElementById("nome").value||"").trim();
      const rg   = (document.getElementById("rg").value||"").trim();
      const cpf  = (document.getElementById("cpf").value||"").trim();
      if(!nome || !rg || !cpf) return toast("Preencha Nome, RG e CPF", true);

      const veiculo = document.getElementById("veiculo").value === "SIM";

      const payload = {
        code,
        slot: selectedSlot,
        nome, rg, cpf,
        veiculo,
        placa: document.getElementById("placa").value||"",
        cor: document.getElementById("cor").value||"",
        modelo: document.getElementById("modelo").value||""
      };

      loading(true);
      const r = await api("vipReserve", payload);
      loading(false);

      if(!r.ok) return toast("‚ùå " + r.error, true);

      showOverlay(false);
      selectedSlot = null;

      // recarrega slots
      const g = await api("vipPublicGet", { code });
      if(g.ok){
        currentSlots = g.slots || [];
        renderGrid();
      }

      toast("‚úÖ Reservado!", true);
    }

    // Fecha modal clicando fora
    document.addEventListener("DOMContentLoaded", ()=>{
      const overlayEl = document.getElementById("overlay");
      if(overlayEl){
        overlayEl.addEventListener("click", (e)=>{
          if(e.target && e.target.id === "overlay") fechar();
        });
      }
    });

    // helpers
    function escapeHtml(s){
      return String(s??"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
    }
    function escapeJs(s){
      return String(s??"").replace(/['\\]/g, "\\$&");
    }

    // exp√µe fun√ß√µes pro HTML
    window.entrar = entrar;
    window.confirmar = confirmar;
    window.fechar = fechar;
    window.clickSlot = clickSlot;
    window.toggleVeiculo = toggleVeiculo;
  </script>
</body>
</html>
